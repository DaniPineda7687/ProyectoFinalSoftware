<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <title>Cálculos Científicos</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script th:src="@{/js/config.js}"></script>
</head>

<body class="container py-5">
    <h1 class="mb-4">Cálculos Científicos</h1>

    <!-- Enlace de regreso -->
    <div class="mb-4">
        <a href="/" class="btn btn-outline-secondary">← Volver al Menú Principal</a>
    </div>

    <!-- Saludo del servicio -->
    <div class="card mb-4">
        <div class="card-header">
            <h5 class="mb-0">Estado del Servicio</h5>
        </div>
        <div class="card-body">
            <button id="btnSaludo" class="btn btn-info">Verificar Servicio</button>
            <div id="saludoResult" class="mt-2"></div>
        </div>
    </div>

    <!-- Multiplicación de Matrices -->
    <div class="card mb-4">
        <div class="card-header">
            <h5 class="mb-0">Multiplicación de Matrices Paralela</h5>
        </div>
        <div class="card-body">
            <form id="matrixForm">
                <div class="row g-3">
                    <div class="col-md-6">
                        <label for="matrixA" class="form-label">Matriz A (JSON)</label>
                        <textarea class="form-control" id="matrixA" rows="4"
                            placeholder="Ejemplo: [[1, 2], [3, 4]]">[ [1, 2], [3, 4] ]</textarea>
                    </div>
                    <div class="col-md-6">
                        <label for="matrixB" class="form-label">Matriz B (JSON)</label>
                        <textarea class="form-control" id="matrixB" rows="4"
                            placeholder="Ejemplo: [[5, 6], [7, 8]]">[ [5, 6], [7, 8] ]</textarea>
                    </div>
                    <div class="col-md-6">
                        <label for="threadsMatrix" class="form-label">Número de Hilos</label>
                        <input type="number" class="form-control" id="threadsMatrix" value="4" min="1" max="16">
                    </div>
                    <div class="col-12">
                        <button type="submit" class="btn btn-primary">Multiplicar Matrices</button>
                    </div>
                </div>
            </form>
            <div id="matrixResult" class="mt-3"></div>
        </div>
    </div>

    <!-- Estimación de Pi usando Monte Carlo -->
    <div class="card mb-4">
        <div class="card-header">
            <h5 class="mb-0">Estimación de π usando Monte Carlo</h5>
        </div>
        <div class="card-body">
            <form id="piForm">
                <div class="row g-3">
                    <div class="col-md-6">
                        <label for="iterations" class="form-label">Número de Iteraciones</label>
                        <input type="number" class="form-control" id="iterations" value="1000000" min="1000">
                    </div>
                    <div class="col-md-6">
                        <label for="threadsPi" class="form-label">Número de Hilos</label>
                        <input type="number" class="form-control" id="threadsPi" value="4" min="1" max="16">
                    </div>
                    <div class="col-12">
                        <button type="submit" class="btn btn-success">Estimar π</button>
                    </div>
                </div>
            </form>
            <div id="piResult" class="mt-3"></div>
        </div>
    </div>

    <script>
        $(document).ready(function () {
            // Verificar estado del servicio
            $('#btnSaludo').click(function () {
                $.get(apiConfig.cientifico.hello)
                    .done(function (data) {
                        $('#saludoResult').html('<div class="alert alert-success">✅ Servicio activo: ' + data + '</div>');
                    })
                    .fail(function (xhr, status, error) {
                        $('#saludoResult').html('<div class="alert alert-danger">❌ Error: ' + error + '</div>');
                    });
            });

            // Multiplicación de matrices
            $('#matrixForm').submit(function (e) {
                e.preventDefault();

                let matrixA, matrixB;
                try {
                    matrixA = JSON.parse($('#matrixA').val());
                    matrixB = JSON.parse($('#matrixB').val());
                } catch (error) {
                    $('#matrixResult').html('<div class="alert alert-danger">❌ Error en formato JSON: ' + error.message + '</div>');
                    return;
                }

                const request = {
                    a: matrixA,
                    b: matrixB,
                    threads: parseInt($('#threadsMatrix').val())
                };

                $.ajax({
                    url: apiConfig.cientifico.matrix,
                    method: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify(request)
                })
                    .done(function (data) {
                        const resultHtml = '<div class="alert alert-success">' +
                            '<h6>✅ Resultado de la multiplicación:</h6>' +
                            '<pre>' + JSON.stringify(data.result, null, 2) + '</pre>' +
                            '</div>';
                        $('#matrixResult').html(resultHtml);
                    })
                    .fail(function (xhr, status, error) {
                        $('#matrixResult').html('<div class="alert alert-danger">❌ Error: ' + error + '</div>');
                    });
            });

            // Estimación de Pi
            $('#piForm').submit(function (e) {
                e.preventDefault();

                const iterations = parseInt($('#iterations').val());
                const threads = parseInt($('#threadsPi').val());

                $('#piResult').html('<div class="alert alert-info">⏳ Calculando π... Esto puede tomar unos segundos.</div>');

                $.get(apiConfig.cientifico.pi + '?iterations=' + iterations + '&threads=' + threads)
                    .done(function (data) {
                        const precision = Math.abs(data.piEstimate - Math.PI);
                        const resultHtml = '<div class="alert alert-success">' +
                            '<h6>✅ Estimación de π completada:</h6>' +
                            '<p><strong>Valor estimado:</strong> ' + data.piEstimate + '</p>' +
                            '<p><strong>Valor real de π:</strong> ' + Math.PI + '</p>' +
                            '<p><strong>Diferencia:</strong> ' + precision.toFixed(10) + '</p>' +
                            '<p><strong>Iteraciones:</strong> ' + iterations.toLocaleString() + '</p>' +
                            '<p><strong>Hilos utilizados:</strong> ' + threads + '</p>' +
                            '</div>';
                        $('#piResult').html(resultHtml);
                    })
                    .fail(function (xhr, status, error) {
                        $('#piResult').html('<div class="alert alert-danger">❌ Error: ' + error + '</div>');
                    });
            });
        });
    </script>
</body>

</html>